# /etc/ddos-guard/ddos-guard.conf
# DDoS Guard Configuration File

# Number of SYN-RECV connections from a subnet to trigger blocking
THRESHOLD=10

# Seconds between detection scans
CHECK_INTERVAL=30

# Subnet mask to block (24 = /24, 16 = /16, etc.)
SUBNET_MASK=24

# Ports to monitor (space-separated)
PORTS="443"

# Enable IPv4 detection
ENABLE_IPV4=true

# Enable IPv6 detection
ENABLE_IPV6=false

# Auto-unblock after X hours (0 = never unblock)
AUTO_UNBLOCK_HOURS=0

# Save iptables rules persistently
SAVE_IPTABLES=true

#
# Advanced Detection Options (helps reduce false positives)
#

# Detection mode: "count", "age", or "rate"
# - count: Block if current SYN-RECV count exceeds threshold
# - age: Only count SYN-RECV connections older than MIN_CONNECTION_AGE seconds
# - rate: Block if new connections per time window exceed threshold
DETECTION_MODE="age"

# Minimum connection age in seconds (for age mode)
# Only count SYN-RECV connections that have been stuck for this long
# Legitimate connections complete in <1 second, attacks persist longer
# Recommended: 3-5 seconds
MIN_CONNECTION_AGE=3

# Rate tracking window in seconds (for rate mode)
# Track connection rate over this time period
# Recommended: 60-300 seconds
RATE_WINDOW=60

# Per-IP rate limit (connections per minute, 0 = disabled)
# Block individual IPs exceeding this rate regardless of subnet aggregation
# Helps catch single-source attacks before they reach subnet threshold
# Recommended: 20-50 for most sites
PER_IP_RATE_LIMIT=30

#
# Metrics and Monitoring Options
#

# Enable Prometheus metrics export (for Grafana visualization)
# Requires node_exporter with textfile collector enabled
ENABLE_METRICS=false

# Path to Prometheus metrics file (node_exporter textfile collector)
# Default: /var/run/ddos-guard/ddos_guard.prom
# Note: /var/run is a tmpfs and always writable, no special permissions needed
METRICS_FILE="/var/run/ddos-guard/ddos_guard.prom"

# Enable GeoIP lookups for blocked subnets (requires MaxMind GeoLite2 database)
# Provides country, city, and coordinates for Grafana world map visualization
ENABLE_GEOIP=false

# Path to MaxMind GeoLite2 City database
# Download from: https://dev.maxmind.com/geoip/geoip2/geolite2/
# Default: /usr/share/GeoIP/GeoLite2-City.mmdb
GEOIP_DB_PATH="/usr/share/GeoIP/GeoLite2-City.mmdb"

# Enable ASN (Autonomous System Number) lookup
# Provides information about ISP/hosting provider of attacking IPs
ENABLE_ASN_LOOKUP=false

# Path to MaxMind GeoLite2 ASN database
# Download from: https://dev.maxmind.com/geoip/geoip2/geolite2/
# Default: /usr/share/GeoIP/GeoLite2-ASN.mmdb
ASN_DB_PATH="/usr/share/GeoIP/GeoLite2-ASN.mmdb"

# ASN lookup method: "mmdb" (MaxMind local), "cymru" (DNS-based), or "disabled"
# mmdb = Fast, offline, requires database download
# cymru = No database needed, requires internet, slower
ASN_LOOKUP_METHOD="mmdb"

#
# Threat Intelligence Sharing Options
#

# Enable community threat intelligence sharing
# When enabled, blocked subnets are exported to JSON for sharing
ENABLE_INTEL_SHARING=false

# URL to download community threat intelligence feed (GitHub-based)
# Default points to community feed (update when available)
INTEL_FEED_URL="https://raw.githubusercontent.com/ddos-guard/threat-intel/main/blocked_subnets.json"

# Automatically block subnets from threat intelligence feed
# WARNING: Only enable if you trust the feed source
AUTO_BLOCK_FROM_FEED=false

